<table class="index">
  <thead>
    <tr>
      <th><%= t('spree.name') %></th>
      <th><%= t('spree.available_on') %></th>
      <th><%= t('spree.options') %></th>
      <th><%= t('spree.qty') %></th>
      <th></th>
    </tr>
  </thead>
  <tbody>
    <% @available_products.each do |product| %>
      <tr id="<%= dom_id(product) %>">
        <td><%= product.name %></td>
        <td><%= product.available_on %></td>
        <td>
          <% if product.has_variants? %>
            <%=
              select_tag(
                "part[id]",
                options_for_select(product.variants.map { |v| [variant_options(v), v.id] })
              )
            %>
          <% else %>
            <%= hidden_field_tag "part[id]", product.master.id %>
            <%= t('spree.no_variants') %>
          <% end %>
        </td>
        <td><%= text_field_tag "part[count]", 1 %></td>
        <td class="actions">
          <%=
            link_to(
              t('spree.add'),
              admin_product_parts_path(@product),
              :class => "add_product_part_link btn btn-primary"
            )
          %>
        </td>
      </tr>
    <% end %>

    <% if @available_products.empty? %>
      <tr>
        <td colspan="4">
          <%= t('spree.no_match_found') %>
        </td>
      </tr>
    <% end %>
  </tbody>
</table>

<%= javascript_tag do %>
  $("a.add_product_part_link").click(function(){
  part_id_val = $('select option:selected', $(this).parent().parent()).val() ||
  $('input:first', $(this).parent().parent()).val();
  params = { part_count :  $('input:last', $(this).parent().parent()).val(),
  part_id : part_id_val};
  return make_post_request($(this), params);
  });
<% end %>
